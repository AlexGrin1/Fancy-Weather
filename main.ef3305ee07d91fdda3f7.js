(()=>{"use strict";const e={EN:{text:"",feel:"FEELS LIKE",wind:"WIND",speed:"m/s",humidity:"HUMIDITY",search:"SEARCH",placeholder:"Search city",latitude:"Latutude",longitude:"Longitude"},RU:{text:"",feel:"ОЩУЩАЕТСЯ КАК",wind:"ВЕТЕР",speed:"м/с",humidity:"ВЛАЖНОСТЬ",search:"ПОИСК",placeholder:"Искать город",latitude:"Широта",longitude:"Долгота"}},t=document.getElementById("time"),n=document.getElementById("date"),a=document.getElementById("choice_lang"),o=document.querySelector("#search"),c=document.querySelector("input"),r=document.getElementById("location");let i=localStorage.getItem("language")||"EN";setInterval((()=>{!function(){const e=new Date,t=e.toLocaleString(`${i}`,{month:"long"}),a=e.getDate();n.innerHTML=`${e.toLocaleString(`${i}`,{weekday:"short"})} ${a} ${t}`}(),function(){const e=new Date((new Date).toLocaleString("en-US",{timeZone:`${k}`})),n=e.getHours().toString(),a=e.getMinutes().toString(),o=e.getSeconds().toString();t.innerHTML=`${n.padStart(2,"0")}:${a.padStart(2,"0")}:${o.padStart(2,"0")}`}()}),1e3),a.addEventListener("change",(t=>{var n;i=(n=t).target.value,o.innerHTML=`${e[i].search}`,c.setAttribute("placeholder",`${e[i].placeholder}`),localStorage.setItem("language",n.target.value),b(r.textContent)}));const l=document.getElementById("location"),d=document.getElementById("temp"),s=document.querySelector(".innerInfo"),u=document.querySelector(".weatherOn3Days"),m=document.querySelector("input"),g=document.querySelector("form"),p=document.querySelector("#choice_temp"),y=p.querySelectorAll("button"),v=document.querySelector(".coordinates"),h=document.getElementById("refreshImage"),f=document.querySelectorAll("option");let $,S,L,w;async function b(t){try{const n=await fetch(`https://api.weatherapi.com/v1/forecast.json?key=e656736c26754e098db140545212405&q=${t}&days=4&lang=${i}`),a=await n.json();a.error&&1006===a.error.code&&alert("Город не найден. Попробуйте заново");const o=[a.location.lon,a.location.lat];k=a.location.tz_id,function(t){l.innerHTML="",d.innerHTML="",s.innerHTML="",u.innerHTML="",v.innerHTML="",$=localStorage.getItem("temperature")||document.querySelector(".active").dataset.value,y.forEach((e=>{e.classList.remove("active"),e.dataset.value===$&&e.classList.add("active")})),S="c"===$?"temp_c":"temp_f",L="c"===$?"feelslike_c":"feelslike_f",w="c"===$?"maxtemp_c":"maxtemp_f",function(t){l.textContent=`${t.location.name.toUpperCase()}, ${t.location.country.toUpperCase()}`,d.innerHTML=`${Math.round(t.current[S])}&#176`,s.innerHTML=`<img src=${t.current.condition.icon} class="icon">\n  <div class='info_element'>${t.current.condition.text.toUpperCase()}</div>\n  <div class='info_element'>${e[i].feel}: ${Math.round(t.current[L])} &#176</div>\n  <div class='info_element'>${e[i].wind}: ${Math.round(t.current.wind_kph*(5/18))} ${e[i].speed}</div>\n  <div class='info_element'>${e[i].humidity}: ${t.current.humidity}%</div>\n  `}(t),function(e){e.forecast.forecastday.forEach((e=>{const t=document.createElement("div");t.className="blockDayWeather",t.innerHTML=`\n    <div class="weekDayNext>\n      <div class="weekDay">${new Date(e.date).toLocaleString(`${i}`,{weekday:"long"}).toUpperCase()}\n      </div>\n    </div>\n    <div class='weekDayWeather'>\n      <div class="next_day_weather">${Math.round(e.day[w])}&#176</div>\n       <img src=${e.day.condition.icon}>\n    </div>`,u.appendChild(t)}))}(t),function(t){const n=String(t.location.lat).split("."),a=String(t.location.lon).split(".");v.innerHTML=`\n  <div>${e[i].latitude}: ${n[0]}&#176 ${n[1]}'</div>\n  <div>${e[i].longitude}: ${a[0]}&#176 ${a[1]}'</div>\n  `}(t)}(a),m!==t&&I(),function(e){mapboxgl.accessToken="pk.eyJ1IjoiamVyb21pdHJ1IiwiYSI6ImNrcDV0MXRmMjF4bDQyb213NGpxZTNiNDkifQ.VgwARiMKZjGIkaYakkpQQw",new mapboxgl.Map({container:"map",center:e,zoom:9,interactive:!1,style:"mapbox://styles/mapbox/streets-v11"})}(o)}catch(e){console.log(e),alert("Что-то пошло не так"),E()}}let k="Europe/Minsk";async function E(){try{const e=await fetch("https://ipinfo.io?token=6520844a54f3ec"),t=await e.json();k=t.timezone,b(t.city)}catch(e){alert("Что-то пошло не так"),console.log(e)}}async function I(){try{const e=await fetch("https://api.unsplash.com/photos/random?orientation=landscape&per_page=1&query=nature&client_id=7wYU5zOAy4uV-EdWgZkKEbVoLxPO4CCd_fhjcsRp5v8"),t=await e.json();document.body.style.background=`linear-gradient(rgba(8, 15, 26, 0.59) 0%, rgba(17, 17, 46, 0.46) 100%) 0% 0% / cover, url(${t.urls.full}), no-repeat`,document.body.style.backgroundImage=`url(${t.urls.full})`,document.body.style.backgroundSize="cover",document.body.style.backgroundAttachment="fixed"}catch(e){alert("Ошибка загрузки фонового изображения")}}document.addEventListener("DOMContentLoaded",(e=>{E(),f.forEach((e=>{e.removeAttribute("selected"),e.dataset.value.toUpperCase()===localStorage.getItem("language").toUpperCase()&&e.setAttribute("selected","")})),g.addEventListener("submit",(e=>{e.preventDefault(),b(m.value),m.value=""})),p.addEventListener("click",(e=>{$!==e.target.dataset.value&&(localStorage.setItem("temperature",e.target.dataset.value),b(l.textContent))})),h.addEventListener("click",(e=>{I()}))}))})();
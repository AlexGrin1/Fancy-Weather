(()=>{"use strict";const e=document.getElementById("time"),t=document.getElementById("date"),n=document.getElementById("choice_lang"),o=document.querySelector("#search"),a=document.querySelector("input"),r=document.getElementById("location");let c=localStorage.getItem("language")||"EN";function i(e=(new Date).getHours()){return e>=21&&e<24||e>=0&&e<5?"night":"day"}setInterval((()=>{!function(){const e=new Date,n=e.toLocaleString(c,{weekday:"short"}),o=e.toLocaleString(c,{month:"long"}),a=e.getDate();t.innerHTML=`${n} ${a} ${o}`}(),function(){const t=new Date((new Date).toLocaleString("en-US",{timeZone:k}));e.innerHTML=t.toLocaleTimeString()}()}),1e3),n.addEventListener("change",(e=>{!function(e){c=e,o.innerHTML=`${l[c].search}`,a.setAttribute("placeholder",`${l[c].placeholder}`),localStorage.setItem("language",e)}(e.target.value),E(r.textContent)}));const l={EN:{feel:"FEELS LIKE",wind:"WIND",speed:"m/s",humidity:"HUMIDITY",search:"SEARCH",placeholder:"Search city",latitude:"Latutude",longitude:"Longitude",errorFindCity:"The city was not found. Try again",errorImages:"Error loading background image",errorOther:"Something went wrong"},RU:{feel:"ОЩУЩАЕТСЯ КАК",wind:"ВЕТЕР",speed:"м/с",humidity:"ВЛАЖНОСТЬ",search:"ПОИСК",placeholder:"Искать город",latitude:"Широта",longitude:"Долгота",errorFindCity:"Город не найден. Попробуйте заново",errorImages:"Ошибка загрузки фонового изображения",errorOther:"Что-то пошло не так"},icons:{getIcon:e=>{console.log(e);const t={lightRain:[1063,1072,1153,1168,1183,1240,1261,1198],moderateRain:[1189,1186,1237],heavyRain:[1237,1264,1246,1195],lightSnow:[1066,1252,1069,1210],moderateSnow:[1201,1216,1204,1219,1255,1237],heavySnow:[1114,1222,1225,1258],partlyCloudy:[1003,1006],cloudy:[1009,1135,1147,1030],clear:[1e3]};for(const[n,o]of Object.entries(t))if(o.includes(e))return"partlyCloudy"===n||"clear"===n?`./assets/${n}${i()}.svg`:`./assets/${n}.svg`}}},d=document.getElementById("location"),s=document.getElementById("temp"),u=document.querySelector(".innerInfo"),m=document.querySelector(".weatherOn3Days"),g=document.querySelector("input"),y=document.querySelector("form"),h=document.querySelector("#choice_temp"),p=h.querySelectorAll("button"),v=document.querySelector(".coordinates"),f=document.getElementById("refreshImage"),w=document.querySelectorAll("option");let S,$,I,L;async function E(e){try{const t=await fetch(`https://api.weatherapi.com/v1/forecast.json?key=e656736c26754e098db140545212405&q=${e}&days=4&lang=${c}`),n=await t.json();n.error&&1006===n.error.code&&alert(l[c].errorFindCity);const o=[n.location.lon,n.location.lat];k=n.location.tz_id,function(e){d.innerHTML="",s.innerHTML="",u.innerHTML="",m.innerHTML="",v.innerHTML="",S=localStorage.getItem("temperature")||document.querySelector(".active").dataset.value,p.forEach((e=>{e.classList.remove("active"),e.dataset.value===S&&e.classList.add("active")})),$="c"===S?"temp_c":"temp_f",I="c"===S?"feelslike_c":"feelslike_f",L="c"===S?"maxtemp_c":"maxtemp_f",function(e){const t=e.location.name,n=e.location.country,o=l.icons.getIcon(e.current.condition.code),a=e.current.condition.text,r=Math.round(e.current[I]),i=Math.round(e.current.wind_kph*(5/18)),m=e.current.humidity;d.textContent=`${t}, ${n}`,s.innerHTML=`${Math.round(e.current[$])}&#176`,u.innerHTML=`<img src=${o} class="icon">\n  <div class='info_element'>${a}</div>\n  <div class='info_element'>${l[c].feel}: ${r} &#176</div>\n  <div class='info_element'>${l[c].wind}: ${i} ${l[c].speed}</div>\n  <div class='info_element'>${l[c].humidity}: ${m}%</div>\n  `}(e),function(e){m.innerHtml="",e.forecast.forecastday.forEach((e=>{const t=Math.round(e.day[L]),n=l.icons.getIcon(e.day.condition.code),o=new Date(e.date).toLocaleString(c,{weekday:"long"});m.innerHTML+=`\n    <div class="blockDayWeather">\n      <div class="weekDayNext>\n        <div class="week_day">${o}</div>\n      \n      <div class='weekDayWeather'>\n        <div class="next_day_weather">${t}&#176</div>\n        <img src='${n}'>\n      </div>\n      </div>\n    </div>`}))}(e),function(e){const t=String(e.location.lat).split("."),n=String(e.location.lon).split(".");v.innerHTML=`\n  <div>${l[c].latitude}: ${t[0]}&#176 ${t[1]}'</div>\n  <div>${l[c].longitude}: ${n[0]}&#176 ${n[1]}'</div>\n  `}(e)}(n),function(e){mapboxgl.accessToken="pk.eyJ1IjoiamVyb21pdHJ1IiwiYSI6ImNrcDV0MXRmMjF4bDQyb213NGpxZTNiNDkifQ.VgwARiMKZjGIkaYakkpQQw",new mapboxgl.Map({container:"map",center:e,zoom:9,interactive:!1,style:"mapbox://styles/mapbox/streets-v11"})}(o)}catch(e){alert(l[c].errorOther),M()}}let k="Europe/Minsk";async function M(){try{const e=await fetch("https://ipinfo.io?token=6520844a54f3ec"),t=await e.json();k=t.timezone,E(t.city)}catch(e){alert(l[c].errorOther)}}async function b(){try{const e=await fetch("https://api.unsplash.com/photos/random?orientation=landscape&per_page=1&query=nature&client_id=7wYU5zOAy4uV-EdWgZkKEbVoLxPO4CCd_fhjcsRp5v8"),t=await e.json();document.body.style.background=`linear-gradient(rgba(8, 15, 26, 0.59) 0%, rgba(17, 17, 46, 0.46) 100%) 0% 0% , url(${t.urls.full}), no-repeat`}catch(e){alert(l[c].errorImages)}}document.addEventListener("DOMContentLoaded",(e=>{b(),M(),w.forEach((e=>{e.removeAttribute("selected"),e.dataset.value.toUpperCase()===localStorage.getItem("language").toUpperCase()&&e.setAttribute("selected","")})),y.addEventListener("submit",(e=>{e.preventDefault(),E(g.value),b(),g.value=""})),h.addEventListener("click",(e=>{S!==e.target.dataset.value&&(localStorage.setItem("temperature",e.target.dataset.value),E(d.textContent))})),f.addEventListener("click",(e=>{b()}))}))})();
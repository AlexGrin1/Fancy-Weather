(()=>{"use strict";const e=document.getElementById("time"),t=document.getElementById("date"),n=document.getElementById("choice_lang"),a=document.querySelector("#search"),o=document.querySelector("input"),c=document.getElementById("location");let i=localStorage.getItem("language")||"EN";function s(e){return 21<e<23||0<e<5?"night":"day"}setInterval((()=>{!function(){const e=new Date,n=e.toLocaleString(i,{month:"long"}),a=e.getDate();t.innerHTML=`${e.toLocaleString(i,{weekday:"short"})} ${a} ${n}`}(),function(){const t=new Date((new Date).toLocaleString("en-US",{timeZone:`${k}`})),n=t.getHours().toString(),a=t.getMinutes().toString(),o=t.getSeconds().toString();e.innerHTML=`${n.padStart(2,"0")}:${a.padStart(2,"0")}:${o.padStart(2,"0")}`,s(n)}()}),1e3),n.addEventListener("change",(e=>{var t;i=(t=e).target.value,a.innerHTML=`${d[i].search}`,o.setAttribute("placeholder",`${d[i].placeholder}`),localStorage.setItem("language",t.target.value),b(c.textContent)}));const d={EN:{text:"",feel:"FEELS LIKE",wind:"WIND",speed:"m/s",humidity:"HUMIDITY",search:"SEARCH",placeholder:"Search city",latitude:"Latutude",longitude:"Longitude",sunny:"./assets/day.svg"},RU:{text:"",feel:"ОЩУЩАЕТСЯ КАК",wind:"ВЕТЕР",speed:"м/с",humidity:"ВЛАЖНОСТЬ",search:"ПОИСК",placeholder:"Искать город",latitude:"Широта",longitude:"Долгота"},icons:{codesOfLightRain:[1063,1072,1153,1168,1183,1261,1198],codesOfModerateRain:[1189,1186,1237],heavyRainСodes:[1237,164,1246,1195],codesOfLightSnow:[1066,1252,1069,1210],codesOfModerateSnow:[1201,1216,1204,1219,1255,1237],heavySnowСodes:[1114,1222,1225,1258],partyCloudy:[1003,1006],cloudy:[1009,1135,1147],clear:[1e3],icon:e=>d.icons.codesOfLightRain.includes(e)?"./assets/lightRain.svg":d.icons.codesOfModerateRain.includes(e)?"./assets/moderateRain.svg":d.icons.heavyRainСodes.includes(e)?"./assets/heavyRain.svg":d.icons.codesOfLightSnow.includes(e)?"./assets/lightSnow.svg":d.icons.codesOfModerateSnow.includes(e)?"./assets/moderateSnow.svg":d.icons.heavySnowСodes.includes(e)?"./assets/heavySnow.svg":d.icons.cloudy.includes(e)?"./assets/cloudy.svg":d.icons.partyCloudy.includes(e)?"day"===s()?"./assets/cloudy-day-2.svg":"./assets/cloudy-night-2.svg":d.icons.clear.includes(e)?"day"===s()?"./assets/sunny.svg":"./assets/clear.svg":"./assets/cloudy.svg"}},r=document.getElementById("location"),l=document.getElementById("temp"),u=document.querySelector(".innerInfo"),g=document.querySelector(".weatherOn3Days"),m=document.querySelector("input"),y=document.querySelector("form"),v=document.querySelector("#choice_temp"),h=v.querySelectorAll("button"),p=document.querySelector(".coordinates"),f=document.getElementById("refreshImage"),S=document.querySelectorAll("option");let w,$,L,M;async function b(e){try{const t=await fetch(`https://api.weatherapi.com/v1/forecast.json?key=e656736c26754e098db140545212405&q=${e}&days=4&lang=${i}`),n=await t.json();n.error&&1006===n.error.code&&alert("Город не найден. Попробуйте заново");const a=[n.location.lon,n.location.lat];k=n.location.tz_id,function(e){r.innerHTML="",l.innerHTML="",u.innerHTML="",g.innerHTML="",p.innerHTML="",w=localStorage.getItem("temperature")||document.querySelector(".active").dataset.value,h.forEach((e=>{e.classList.remove("active"),e.dataset.value===w&&e.classList.add("active")})),$="c"===w?"temp_c":"temp_f",L="c"===w?"feelslike_c":"feelslike_f",M="c"===w?"maxtemp_c":"maxtemp_f",function(e){const t=e.location.name,n=e.location.country,a=d.icons.icon(e.current.condition.code),o=e.current.condition.text,c=Math.round(e.current[L]),s=Math.round(e.current.wind_kph*(5/18)),g=e.current.humidity;r.textContent=`${t}, ${n}`,l.innerHTML=`${Math.round(e.current[$])}&#176`,u.innerHTML=`<img src=${a} class="icon">\n  <div class='info_element'>${o}</div>\n  <div class='info_element'>${d[i].feel}: ${c} &#176</div>\n  <div class='info_element'>${d[i].wind}: ${s} ${d[i].speed}</div>\n  <div class='info_element'>${d[i].humidity}: ${g}%</div>\n  `}(e),function(e){e.forecast.forecastday.forEach((e=>{const t=Math.round(e.day[M]),n=d.icons.icon(e.day.condition.code),a=document.createElement("div");a.className="blockDayWeather",a.innerHTML=`\n    <div class="weekDayNext>\n      <div class="week_day">${new Date(e.date).toLocaleString(i,{weekday:"long"})}\n      </div>\n    </div>\n    <div class='weekDayWeather'>\n      <div class="next_day_weather">${t}&#176</div>\n       <img src='${n}'>\n    </div>`,g.appendChild(a)}))}(e),function(e){const t=String(e.location.lat).split("."),n=String(e.location.lon).split(".");p.innerHTML=`\n  <div>${d[i].latitude}: ${t[0]}&#176 ${t[1]}'</div>\n  <div>${d[i].longitude}: ${n[0]}&#176 ${n[1]}'</div>\n  `}(e)}(n),m!==e&&I(),function(e){mapboxgl.accessToken="pk.eyJ1IjoiamVyb21pdHJ1IiwiYSI6ImNrcDV0MXRmMjF4bDQyb213NGpxZTNiNDkifQ.VgwARiMKZjGIkaYakkpQQw",new mapboxgl.Map({container:"map",center:e,zoom:9,interactive:!1,style:"mapbox://styles/mapbox/streets-v11"})}(a)}catch(e){alert("Что-то пошло не так"),E()}}let k="Europe/Minsk";async function E(){try{const e=await fetch("https://ipinfo.io?token=6520844a54f3ec"),t=await e.json();k=t.timezone,b(t.city)}catch(e){alert("Что-то пошло не так")}}async function I(){try{const e=await fetch("https://api.unsplash.com/photos/random?orientation=landscape&per_page=1&query=nature&client_id=7wYU5zOAy4uV-EdWgZkKEbVoLxPO4CCd_fhjcsRp5v8"),t=await e.json();document.body.style.background=`linear-gradient(rgba(8, 15, 26, 0.59) 0%, rgba(17, 17, 46, 0.46) 100%) 0% 0% / cover, url(${t.urls.full}), no-repeat`,document.body.style.backgroundImage=`url(${t.urls.full})`,document.body.style.backgroundSize="cover",document.body.style.backgroundAttachment="fixed"}catch(e){alert("Ошибка загрузки фонового изображения")}}document.addEventListener("DOMContentLoaded",(e=>{E(),S.forEach((e=>{e.removeAttribute("selected"),e.dataset.value.toUpperCase()===localStorage.getItem("language").toUpperCase()&&e.setAttribute("selected","")})),y.addEventListener("submit",(e=>{e.preventDefault(),b(m.value),m.value=""})),v.addEventListener("click",(e=>{w!==e.target.dataset.value&&(localStorage.setItem("temperature",e.target.dataset.value),b(r.textContent))})),f.addEventListener("click",(e=>{I()}))}))})();